<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil</title>
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="img/patalogo.png" type="image/x-icon">

</head>

<body>
    <header class="header">
        <div class="logo">
            <img src="img/LOGO.png" alt="Logo">
        </div>
        <div class="search-bar">
            <input type="text" placeholder="O que você precisa?">
        </div>
        <div class="icons">
            <img src="img/coração.png" alt="Coração">
            <img src="img/shopping.png" alt="Sacola">
            <a href="../PerfilUser/perfil.html">
                <img src="img/perfil.png" alt="Perfil">
            </a>
        </div>
    </header>

    <nav class="menu">
        <ul>
            <li><a href="../Home/Home.html">Home</a></li>
            <li><a href="#">Shopping</a></li>
            <li><a href="#">Doadores</a></li>
            <li><a href="#">Blog</a></li>
            <li><a href="#">Animais</a></li>
        </ul>
    </nav>

    <section class="content-box">
        <div class="section1">
            <div class="profile-header">
                <h1>Perfil</h1>
                <h2>Dashboard / Perfil</h2>
                <div class="header-underline"></div> <!-- Linha adicionada -->
            </div>
            <div class="vertical-box">
                <img src="img/fotoperfil.jpg" alt="Foto" class="vertical-box-img">
                <div class="info">
                    <p class="info-title">Nome</p>
                    <p class="info-text">Rafael</p>
                    <p class="info-title">E-mail</p>
                    <p class="info-text">rafael.romero@gmail.com</p>
                </div>
            </div> <!-- Caixa vertical adicionada -->
            <div class="vertical-box2">
                <div class="header-info">
                    <span class="header-title">Meus Dados</span>
                    <button class="edit-button">
                        <img src="img/lapiseditar.png" alt="Editar" class="edit-icon">
                        Editar
                    </button>
                </div>

                <hr class="header-line">

                <form class="info-form">
                    <div class="form-row">
                        <div class="form-group full-name-group">
                            <label for="full-name">Nome Completo</label>
                            <input type="text" id="full-name" name="full-name" required readonly>
                        </div>
                        <div class="form-group nickname-group">
                            <label for="nickname">Apelido</label>
                            <input type="text" id="nickname" name="nickname" required readonly>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group small-group">
                            <label for="cpf">CPF</label>
                            <input type="text" id="cpf" name="cpf" required readonly>
                        </div>
                        <div class="form-group small-group">
                            <label for="gender">Sexo</label>
                            <select id="gender" name="gender" required readonly>
                                <option disabled selected>Selecione o seu sexo</option>
                                <option value="masculino">Masculino</option>
                                <option value="feminino">Feminino</option>
                                <option value="outro">Outro</option>
                            </select>
                        </div>
                        <div class="form-group small-group">
                            <label for="phone">Telefone</label>
                            <input type="tel" id="phone" name="phone" required readonly>
                        </div>
                    </div>
                </form>

                <div class="header-info">
                    <span class="header-title">Endereço</span>
                </div>

                <hr class="header-line">

                <form class="address-form">
                    <div class="address-row">
                        <div class="form-group street-group">
                            <label for="street">Rua</label>
                            <input type="text" id="street" name="street" required readonly>
                        </div>
                        <div class="form-group number-group">
                            <label for="number">Número</label>
                            <input type="text" id="number" name="number" required readonly>
                        </div>
                    </div>

                    <div class="address-row">
                        <div class="form-group bairro-group">
                            <label for="bairro">Bairro</label>
                            <input type="text" id="bairro" name="bairro" required readonly>
                        </div>
                        <div class="form-group cep-group">
                            <label for="cep">CEP</label>
                            <input type="text" id="cep" name="cep" required readonly>
                        </div>
                        <div class="form-group country-group">
                            <label for="country">País</label>
                            <input type="text" id="country" name="country" required readonly>
                        </div>
                    </div>
                </form>

            </div> <!-- Caixa vertical adicionada -->
        </div>

        <div class="secondary-box">
            <!-- Título da segunda box -->
            <div class="favorite-animals-header">
                <h1>Animais Favoritos</h1>
            </div>

            <!-- Carrossel de cards -->
            <div class="carousel-container">
                <div class="carousel">
                    <div class="card">
                        <img src="img/dog1.svg" alt="Descrição da imagem" class="card-img">
                        <div class="card-content">
                            <h3>Amora <img src="img/sexo fem.svg" alt="sexo feminino"> </h3>
                            <p>5 anos | Minas Gerais</p>
                        </div>
                    </div>
                    <div class="card">
                        <img src="img/dog2.svg" alt="Descrição da imagem" class="card-img">
                        <div class="card-content">
                            <h3>Pudim <img src="img/sexo masc.svg" alt="sexo masculino"> </h3>
                            <p>9 anos | Rio de Janeiro</p>
                        </div>
                    </div>
                    <div class="card">
                        <img src="img/dog3.jpg" alt="Descrição da imagem" class="card-img">
                        <div class="card-content">
                            <h3>Jonas <img src="img/sexo masc.svg" alt="sexo masculino"> </h3>
                            <p>5 anos | Flamengo</p>
                        </div>
                    </div>
                    <div class="card">
                        <img src="img/dog4.svg" alt="Descrição da imagem" class="card-img">
                        <div class="card-content">
                            <h3>Jiorgio <img src="img/sexo masc.svg" alt="sexo masculino"> </h3>
                            <p>2 anos | São Paulo</p>
                        </div>
                    </div>
                    <div class="card">
                        <img src="img/dog5.svg" alt="Descrição da imagem" class="card-img">
                        <div class="card-content">
                            <h3>Barbie <img src="img/sexo fem.svg" alt="sexo feminino"></h3>
                            <p>1 ano | Rio Grande do S.</p>
                        </div>
                    </div>

                </div>
            </div>
    </section>
    <footer class="footer">
        <div class="footer-top">
            <p class="adoption-title">Deseja adotar um animalzinho?</p>
            <button class="adopt-button">Adotar</button>
        </div>

        <div class="footer-divider"></div>

        <div class="footer-columns">
            <div class="column column-1">
                <img src="img/LOGO.png" alt="Logo Miaupets">
            </div>
            <div class="column column-2">
                <h3>Casas de Adoção</h3>
                <p>Conheça nossas casas de adoção.</p>
            </div>
            <div class="column column-3">
                <h3>Contatos</h3>
                <p>(18) 3351-0819<br>miaupets@gmail.com</p>
            </div>
            <div class="column column-4">
                <h3>Redes sociais</h3>
                <div class="social-icons">
                    <img src="img/instagram.png" alt="Instagram">
                    <img src="img/facebook.png" alt="Facebook">
                    <img src="img/snapchat.png" alt="Snapchat">
                    <img src="img/x.png" alt="Twitter">
                </div>
                <p>@miaupets</p>
            </div>
        </div>

        <div class="footer-divider"></div>

        <div class="footer-bottom">
            <p>Todos os direitos foram utilizados ©️</p>
        </div>
    </footer>
    <script src="javascript.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Supondo que o token seja armazenado no localStorage
            const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiTHVpcyBIZW5yaXF1ZSBCdWVubyBSb21lcm8iLCJlbWFpbCI6Imx1aXNoZW5yaXF1ZWJ1ZW5vcm9tZXJvQGdtYWlsLmNvbSIsImlhdCI6MTcyODY1NzY3NiwiZXhwIjoxNzMxMjQ5Njc2LCJzdWIiOiIzZTNiYTdhZi1kNTFlLTQ0NDQtODJkNS1iMjViZDhhNjY1YjcifQ.acvi_-YQNx5nAH96nXvfTch4LktvxjIH-TkAZbqQHZQ"; // ou sessionStorage.getItem('token');

            // Função para decodificar o token e obter o ID do usuário
            const getUserIdFromToken = (token) => {
                // Se você estiver usando JWT, pode decodificar usando atob
                const payload = JSON.parse(atob(token.split('.')[1]));
                return payload.userId; // Substitua 'userId' pelo nome correto da chave no seu token
            };

            const userId = getUserIdFromToken(token); // ID do usuário logado

            const preencherDados = async () => {
                try {
                    const response = await fetch(`https://3000-henriquerom-backendmiau-ypctsaxkoc6.ws-us116.gitpod.io/users/${userId}`, {
                        headers: {
                            'Authorization': `Bearer ${token}` // Caso sua API use autenticação via token
                        }
                    });
                    const data = await response.json();

                    if (response.ok) {
                        // Preencher os inputs com os dados do usuário
                        document.getElementById('full-name').value = data.name;
                        document.getElementById('nickname').value = data.nickname || '';
                        document.getElementById('cpf').value = data.cpf;
                        document.getElementById('phone').value = data.phone;
                        document.getElementById('street').value = data.street;
                        document.getElementById('number').value = data.numberHouse;
                        document.getElementById('bairro').value = data.neighborhood;
                        document.getElementById('cep').value = data.cep;
                        document.getElementById('country').value = data.country;
                    } else {
                        console.error('Erro ao carregar dados do usuário:', data.message);
                    }
                } catch (error) {
                    console.error('Erro ao buscar dados do usuário:', error);
                }
            };

            document.addEventListener('DOMContentLoaded', () => {
                const editButton = document.querySelector('.edit-button');
                const inputs = document.querySelectorAll('.info-form input, .address-form input, .info-form select');

                // Permitir edição dos campos
                editButton.addEventListener('click', async () => {
                    const isEditable = inputs[0].readOnly;

                    // Alternar entre editável e não editável
                    inputs.forEach(input => {
                        input.readOnly = !isEditable;
                    });

                    // Alterar o texto do botão
                    if (isEditable) {
                        editButton.innerHTML = '<img src="img/lapiseditar.png" alt="Salvar" class="edit-icon"> Salvar';

                        // Se o botão for "Salvar", enviar os dados ao backend
                        const updatedData = {
                            name: document.getElementById('full-name').value,
                            nickname: document.getElementById('nickname').value,
                            cpf: document.getElementById('cpf').value,
                            phone: document.getElementById('phone').value,
                            street: document.getElementById('street').value,
                            numberHouse: document.getElementById('number').value,
                            neighborhood: document.getElementById('bairro').value,
                            cep: document.getElementById('cep').value,
                            country: document.getElementById('country').value
                        };

                        try {
                            const response = await fetch(`https://sua-api.com/users/${userId}`, {
                                method: 'PUT', // ou PATCH
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': `Bearer ${token}`
                                },
                                body: JSON.stringify(updatedData)
                            });

                            const result = await response.json();

                            if (response.ok) {
                                alert('Dados atualizados com sucesso!');
                            } else {
                                alert('Erro ao atualizar os dados: ' + result.message);
                            }
                        } catch (error) {
                            console.error('Erro ao atualizar os dados:', error);
                        }

                    } else {
                        editButton.innerHTML = '<img src="img/lapiseditar.png" alt="Editar" class="edit-icon"> Editar';
                    }
                });

                // Chamar a função para preencher os dados inicialmente
                preencherDados();
            });

        });

    </script>
</body>

</html>